{"ast":null,"code":"import auth from '@/assets/auth';\nimport 'vue-good-table/dist/vue-good-table.css';\nimport { VueGoodTable } from 'vue-good-table';\nimport vSelect from 'vue-select';\nimport 'vue-select/dist/vue-select.css';\nimport MessageAnnounce from './MessageAnnounce.vue';\nexport default {\n  name: 'CouponsManagement',\n  components: {\n    VueGoodTable,\n    vSelect,\n    MessageAnnounce\n  },\n  data() {\n    return {\n      announce: null,\n      couponToEdit: null,\n      couponsList: [],\n      usersList: [],\n      speakersList: [],\n      columns: [{\n        label: 'Coupon',\n        field: 'titleLink'\n      }, {\n        label: 'Discount %',\n        field: 'discount'\n      }, {\n        label: 'Recipient',\n        field: 'recipient_name'\n      }, {\n        label: 'For guests?',\n        field: this.guestCheck\n      }, {\n        label: 'Invitation type',\n        field: 'invitation_type'\n      }, {\n        label: 'Invitation display',\n        field: this.headlinersCheck\n      }, {\n        label: 'Max uses',\n        field: 'max_uses'\n      }, {\n        label: 'Actual uses',\n        field: 'actual_uses'\n      }, {\n        label: 'View/Edit',\n        field: 'edit'\n      }]\n    };\n  },\n  methods: {\n    killMessage() {\n      this.grabCoupons();\n      this.announce = null;\n    },\n    async grabCoupons() {\n      this.couponsList = [];\n      const url = auth.allCoupons;\n      const headers = {\n        credentials: 'same-origin',\n        'Content-Type': 'application/json',\n        'X-WP-Nonce': this.nonce\n      };\n      fetch(url, {\n        method: 'GET',\n        headers\n      }).then(result => result.json()).then(result => {\n        this.couponsList = result;\n      });\n    },\n    async grabUsers() {\n      this.usersList = [];\n      const url = auth.peopleAndOrgs;\n      const headers = {\n        credentials: 'same-origin',\n        'Content-Type': 'application/json',\n        'X-WP-Nonce': this.nonce\n      };\n      fetch(url, {\n        method: 'GET',\n        headers\n      }).then(result => result.json()).then(result => {\n        this.usersList = result;\n      });\n    },\n    async grabSpeakers() {\n      this.usersList = [];\n      const url = auth.onlyPeople;\n      const headers = {\n        credentials: 'same-origin',\n        'Content-Type': 'application/json',\n        'X-WP-Nonce': this.nonce\n      };\n      fetch(url, {\n        method: 'GET',\n        headers\n      }).then(result => result.json()).then(result => {\n        this.speakersList = result;\n      });\n    },\n    async saveCoupon(cmd) {\n      if (!this.couponToEdit.coupon_title || !this.couponToEdit.discount || !this.couponToEdit.recipient_id) {\n        this.announce = ['Hold it right there...', 'You need to supply all required fields (coupon code, discount % and recipient)'];\n        return;\n      }\n      this.couponToEdit.command = cmd;\n      const data = JSON.stringify(this.couponToEdit);\n      const url = auth.editCouponInvitation;\n      const headers = {\n        credentials: 'same-origin',\n        'Content-Type': 'application/json',\n        'X-WP-Nonce': this.nonce\n      };\n      fetch(url, {\n        method: 'POST',\n        headers,\n        body: data\n      }).then(this.couponToEdit = null).then(result => result.json()).then(result => {\n        this.announce = result;\n      });\n    },\n    guestCheck(rowObj) {\n      if (rowObj.guest_status === '1') {\n        return 'Yes';\n      }\n      return 'No';\n    },\n    headlinersCheck(rowObj) {\n      if (rowObj.headliners.length >= 1) {\n        return 'Custom';\n      }\n      return 'Standard';\n    },\n    editCoupon(rowId) {\n      this.couponToEdit = this.couponsList[rowId];\n      if (this.couponsList[rowId].guest_status === '1') {\n        this.couponToEdit.guest_status = true;\n      } else {\n        this.couponToEdit.guest_status = false;\n      }\n    },\n    startNewCoupon() {\n      this.couponToEdit = {};\n      this.couponToEdit.with_headliners = 'standard';\n      this.couponToEdit.invitation_type = 'generic';\n    },\n    changeGuestStatus(event) {\n      // eslint-disable-next-line\n      if (event.target.checked) {\n        this.couponToEdit.guest_status = true;\n      } else {\n        this.couponToEdit.guest_status = false;\n      }\n    }\n  },\n  mounted() {\n    this.grabCoupons();\n    this.grabUsers();\n    this.grabSpeakers();\n  }\n};","map":{"version":3,"mappings":"AAoKA;AACA;AACA;AACA;AACA;AACA;AAEA;EACAA;EACAC;IACAC;IACAC;IACAC;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC,UACA;QACAC;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA;IAEA;EACA;EACAC;IACAC;MACA;MACA;IACA;IACA;MACA;MACA;MACA;QACAC;QACA;QACA;MACA;MACAC;QAAAC;QAAAC;MAAA,GACAC,8BACAA;QAAA;MAAA;IACA;IACA;MACA;MACA;MACA;QACAJ;QACA;QACA;MACA;MACAC;QAAAC;QAAAC;MAAA,GACAC,8BACAA;QAAA;MAAA;IACA;IACA;MACA;MACA;MACA;QACAJ;QACA;QACA;MACA;MACAC;QAAAC;QAAAC;MAAA,GACAC,8BACAA;QAAA;MAAA;IACA;IACA;MACA,uCACA,+BACA;QACA;QACA;MACA;MACA;MACA;MACA;MACA;QACAJ;QACA;QACA;MACA;MACAC;QAAAC;QAAAC;QAAAE;MAAA,GACAD,+BACAA,8BACAA;QAAA;MAAA;IACA;IACAE;MACA;QACA;MACA;MACA;IACA;IACAC;MACA;QACA;MACA;MACA;IACA;IACAC;MACA;MACA;QACA;MACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;QACA;MACA;QACA;MACA;IACA;EACA;EACAC;IACA;IACA;IACA;EACA;AAEA","names":["name","components","VueGoodTable","vSelect","MessageAnnounce","data","announce","couponToEdit","couponsList","usersList","speakersList","columns","label","field","methods","killMessage","credentials","fetch","method","headers","then","body","guestCheck","headlinersCheck","editCoupon","startNewCoupon","changeGuestStatus","mounted"],"sourceRoot":"src/components","sources":["couponsManagement.vue"],"sourcesContent":["<template>\n  <div class=\"sub-section\" style=\"flex-direction:column;\">\n    <message-announce v-if=\"announce\" :message=\"announce\" @closeMessage=\"killMessage()\" />\n    <vue-good-table\n            :columns=\"columns\"\n            :rows=\"couponsList\"\n            theme=\"black-rhino\"\n            :search-options=\"{\n              enabled: true\n            }\"\n            :pagination-options=\"{\n                enabled: true,\n                perPage: 20,\n                position: 'bottom',\n            }\">\n            <div slot=\"table-actions\">\n              <button class=\"create-new-coupon\" @click=\"startNewCoupon\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"ionicon\" viewBox=\"0 0 512 512\"><path d=\"M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208 208-93.31 208-208S370.69 48 256 48zm80 224h-64v64a16 16 0 0 1-32 0v-64h-64a16 16 0 0 1 0-32h64v-64a16 16 0 0 1 32 0v64h64a16 16 0 0 1 0 32z\"/></svg>\n              </button>\n            </div>\n            <template slot=\"table-row\" slot-scope=\"props\">\n                <span v-if=\"props.column.field == 'edit'\">\n                    <button @click=\"editCoupon(props.row.originalIndex)\">Edit</button>\n                </span>\n                <span v-else-if=\"props.column.field == 'titleLink'\">\n                    <a :href=\"props.row.permalink\" target=\"_blank\" class=\"coupon-link\">\n                      {{props.row.coupon_title}}\n                    </a> &#10140;\n                </span>\n            </template>\n        </vue-good-table>\n        <div class=\"export-section\" style=\"margin-top:100px !important;\">\n          <h3>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"ionicon\" viewBox=\"0 0 512 512\"><path fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"32\" d=\"M336 176h40a40 40 0 0 1 40 40v208a40 40 0 0 1-40 40H136a40 40 0 0 1-40-40V216a40 40 0 0 1 40-40h40\"/><path fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"32\" d=\"m176 272 80 80 80-80M256 48v288\"/></svg>\n            Export coupons</h3>\n          <a\n            class='exporter-butt'\n            href='/wp-content/plugins/eventer/export_coupons.php'\n            target='_blank'\n            >\n            Export coupons\n          </a>\n        </div>\n        <div class=\"edit-shelf\" v-if=\"(couponToEdit !== null)\" v-scroll-lock=\"couponToEdit\">\n            <div class=\"content-wrap\">\n                <span class=\"options-title\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"ionicon\" viewBox=\"0 0 512 512\"><path d=\"M459.94 53.25a16.06 16.06 0 0 0-23.22-.56L424.35 65a8 8 0 0 0 0 11.31l11.34 11.32a8 8 0 0 0 11.34 0l12.06-12c6.1-6.09 6.67-16.01.85-22.38zM399.34 90 218.82 270.2a9 9 0 0 0-2.31 3.93L208.16 299a3.91 3.91 0 0 0 4.86 4.86l24.85-8.35a9 9 0 0 0 3.93-2.31L422 112.66a9 9 0 0 0 0-12.66l-9.95-10a9 9 0 0 0-12.71 0z\"/><path d=\"M386.34 193.66 264.45 315.79A41.08 41.08 0 0 1 247.58 326l-25.9 8.67a35.92 35.92 0 0 1-44.33-44.33l8.67-25.9a41.08 41.08 0 0 1 10.19-16.87l122.13-121.91a8 8 0 0 0-5.65-13.66H104a56 56 0 0 0-56 56v240a56 56 0 0 0 56 56h240a56 56 0 0 0 56-56V199.31a8 8 0 0 0-13.66-5.65z\"/></svg>\n                    <h2>Edit coupon</h2>\n                </span>\n\n                <button class=\"close-button\" @click=\"(couponToEdit = null)\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"ionicon\" viewBox=\"0 0 512 512\"><path fill=\"none\" stroke=\"currentColor\" stroke-miterlimit=\"10\" stroke-width=\"32\" d=\"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z\"/><path fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"32\" d=\"M320 320 192 192m0 128 128-128\"/></svg>\n                </button>\n                <form id=\"edit-registrant\">\n                    <h2>Coupon details</h2>\n                    <input type=\"hidden\" v-model=\"couponToEdit.invitation_post_id\">\n                    <div class=\"double\">\n                        <label for=\"code\">Coupon code\n                        <input type=\"text\" id=\"code\" v-model=\"couponToEdit.coupon_title\"/></label>\n\n                        <label for=\"lname\">Discount\n                        <input type=\"text\" id=\"lname\" v-model=\"couponToEdit.discount\"\n                          placeholder=\"e.g. 75, 50, 100\"/></label>\n                    </div>\n                    <div class=\"double\">\n                        <label for=\"max-uses\">Max uses allowed\n                            <input type=\"number\" id=\"max-uses\"\n                            v-model=\"couponToEdit.max_uses\"/>\n                        </label>\n                        <label for=\"actual-uses\">Actual uses\n                            <input type=\"number\" id=\"actual-uses\"\n                            v-model=\"couponToEdit.actual_uses\" disabled/>\n                        </label>\n                    </div>\n\n                    <h2>Invitation details</h2>\n                    <div class=\"checkbox-wrap\">\n                      <input type=\"checkbox\" @change=\"changeGuestStatus($event)\"\n                      v-model=\"couponToEdit.guest_status\" />\n                      <p>Is this for guests?</p>\n                    </div>\n\n                    <label for=\"related-post\">Recipient\n                        <select name=\"related-post\" v-model=\"couponToEdit.recipient_id\">\n                            <option value=\"other\">Other</option>\n                            <option v-for=\"(item, index) in usersList\"\n                            :value=\"item.id\"\n                            :key=\"index\">\n                            {{item.name}}\n                            </option>\n                        </select>\n                    </label>\n                    <label for=\"other-recipient\" v-show=\"couponToEdit.recipient_id === 'other'\">\n                            Add new recipient if not in dropdown list\n                            <input type=\"text\"\n                                id=\"other-recipient\"\n                                v-model=\"couponToEdit.recipient_name\"/>\n                    </label>\n\n                    <label for=\"coupon-type\">Coupon type\n                        <select id=\"coupon-type\" v-model=\"couponToEdit.invitation_type\">\n                            <option value=\"generic\">Generic coupon</option>\n                            <option value=\"Netcomm member\">Netcomm member</option>\n                            <option value=\"Dagorà member\">Dagorà member</option>\n                            <option value=\"LTCC member\">LTCC member</option>\n                            <option value=\"Brand-retailer-manufacturer\">\n                                Brand/Retailer/Manufacturer</option>\n                            <option value=\"Staff\">Staff</option>\n                            <option value=\"Speaker\">Speaker</option>\n                            <option value=\"Sponsor\">Sponsor</option>\n                            <option value=\"Prospect\">Prospect</option>\n                            <option value=\"Institution\">Institution</option>\n                            <option value=\"School-university\">School/University</option>\n                        </select>\n                        </label>\n\n                        <label for=\"related-post\">Invitation layout\n                        <select id=\"coupon-type\" v-model=\"couponToEdit.with_headliners\">\n                            <option value=\"standard\">Standard</option>\n                            <option value=\"custom\">Custom</option>\n                        </select></label>\n\n                        <div style=\"padding-bottom:40px;\">\n                            <span v-show=\"couponToEdit.with_headliners == 'custom'\">\n                                Choose who appears on the invitation\n                            </span>\n                            <v-select multiple\n                                id=\"custom-headliners\"\n                                name=\"custom-headliners\"\n                                v-show=\"couponToEdit.with_headliners == 'custom'\"\n                                v-model=\"couponToEdit.headliners\"\n                                :options=\"speakersList\"\n                                :reduce=\"speaker => speaker.id\"\n                                label=\"name\"\n                                :closeOnSelect=\"false\">\n                                </v-select>\n                        </div>\n\n                    <div class=\"double\">\n                        <button v-if=\"couponToEdit.invitation_post_id\"\n                        class=\"save-edits form-button\"\n                        type=\"button\" @click=\"saveCoupon('edit')\">\n                        Save edits\n                        </button>\n                        <button v-else\n                        class=\"save-edits form-button\"\n                        type=\"button\" @click=\"saveCoupon('create')\">\n                        Save edits\n                        </button>\n                        <button\n                        v-if=\"couponToEdit.invitation_post_id\"\n                        class=\"delete-registration form-button\"\n                        type=\"button\"\n                        @click=\"saveCoupon('delete')\">\n                        Delete coupon\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n  </div>\n</template>\n\n<script>\nimport auth from '@/assets/auth';\nimport 'vue-good-table/dist/vue-good-table.css';\nimport { VueGoodTable } from 'vue-good-table';\nimport vSelect from 'vue-select';\nimport 'vue-select/dist/vue-select.css';\nimport MessageAnnounce from './MessageAnnounce.vue';\n\nexport default {\n  name: 'CouponsManagement',\n  components: {\n    VueGoodTable,\n    vSelect,\n    MessageAnnounce,\n  },\n  data() {\n    return {\n      announce: null,\n      couponToEdit: null,\n      couponsList: [],\n      usersList: [],\n      speakersList: [],\n      columns: [\n        {\n          label: 'Coupon',\n          field: 'titleLink',\n        },\n        {\n          label: 'Discount %',\n          field: 'discount',\n        },\n        {\n          label: 'Recipient',\n          field: 'recipient_name',\n        },\n        {\n          label: 'For guests?',\n          field: this.guestCheck,\n        },\n        {\n          label: 'Invitation type',\n          field: 'invitation_type',\n        },\n        {\n          label: 'Invitation display',\n          field: this.headlinersCheck,\n        },\n        {\n          label: 'Max uses',\n          field: 'max_uses',\n        },\n        {\n          label: 'Actual uses',\n          field: 'actual_uses',\n        },\n        {\n          label: 'View/Edit',\n          field: 'edit',\n        },\n      ],\n    };\n  },\n  methods: {\n    killMessage() {\n      this.grabCoupons();\n      this.announce = null;\n    },\n    async grabCoupons() {\n      this.couponsList = [];\n      const url = auth.allCoupons;\n      const headers = {\n        credentials: 'same-origin',\n        'Content-Type': 'application/json',\n        'X-WP-Nonce': this.nonce,\n      };\n      fetch(url, { method: 'GET', headers })\n        .then((result) => result.json())\n        .then((result) => { this.couponsList = result; });\n    },\n    async grabUsers() {\n      this.usersList = [];\n      const url = auth.peopleAndOrgs;\n      const headers = {\n        credentials: 'same-origin',\n        'Content-Type': 'application/json',\n        'X-WP-Nonce': this.nonce,\n      };\n      fetch(url, { method: 'GET', headers })\n        .then((result) => result.json())\n        .then((result) => { this.usersList = result; });\n    },\n    async grabSpeakers() {\n      this.usersList = [];\n      const url = auth.onlyPeople;\n      const headers = {\n        credentials: 'same-origin',\n        'Content-Type': 'application/json',\n        'X-WP-Nonce': this.nonce,\n      };\n      fetch(url, { method: 'GET', headers })\n        .then((result) => result.json())\n        .then((result) => { this.speakersList = result; });\n    },\n    async saveCoupon(cmd) {\n      if (!this.couponToEdit.coupon_title\n      || !this.couponToEdit.discount\n      || !this.couponToEdit.recipient_id) {\n        this.announce = ['Hold it right there...', 'You need to supply all required fields (coupon code, discount % and recipient)'];\n        return;\n      }\n      this.couponToEdit.command = cmd;\n      const data = JSON.stringify(this.couponToEdit);\n      const url = auth.editCouponInvitation;\n      const headers = {\n        credentials: 'same-origin',\n        'Content-Type': 'application/json',\n        'X-WP-Nonce': this.nonce,\n      };\n      fetch(url, { method: 'POST', headers, body: data })\n        .then(this.couponToEdit = null)\n        .then((result) => result.json())\n        .then((result) => { this.announce = result; });\n    },\n    guestCheck(rowObj) {\n      if (rowObj.guest_status === '1') {\n        return 'Yes';\n      }\n      return 'No';\n    },\n    headlinersCheck(rowObj) {\n      if (rowObj.headliners.length >= 1) {\n        return 'Custom';\n      }\n      return 'Standard';\n    },\n    editCoupon(rowId) {\n      this.couponToEdit = this.couponsList[rowId];\n      if (this.couponsList[rowId].guest_status === '1') {\n        this.couponToEdit.guest_status = true;\n      } else {\n        this.couponToEdit.guest_status = false;\n      }\n    },\n    startNewCoupon() {\n      this.couponToEdit = {};\n      this.couponToEdit.with_headliners = 'standard';\n      this.couponToEdit.invitation_type = 'generic';\n    },\n    changeGuestStatus(event) {\n      // eslint-disable-next-line\n      if (event.target.checked) {\n        this.couponToEdit.guest_status = true;\n      } else {\n        this.couponToEdit.guest_status = false;\n      }\n    },\n  },\n  mounted() {\n    this.grabCoupons();\n    this.grabUsers();\n    this.grabSpeakers();\n  },\n\n};\n</script>\n\n<style>\n.vs__selected-options span.vs__selected {\n    border:none;\n    height:25px;\n    background:#37bafd;\n    color:white;\n    min-width:100px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}